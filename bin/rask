#!/usr/bin/env node

var fs = require('fs');

var program = require('commander');

program.option('--dev', 'turn on dev mode');

var cgen =
  program
    .command('gen <filename>')
    .description('Generate various source templates.');

cgen.action(function(filename) {
  var hasDev = (function() {
    if (program.dev && fs.existsSync(__dirname + '/assets/' + filename + '.dev')) {
      return '.dev';
    } else {
      return '';
    }
  })();
  fs.readFile(__dirname + '/assets/' + filename + hasDev, function(err, data) {
    if (err) {
      cgen.outputHelp();
      process.exit(0);
    } else {
      console.log(data.toString());
    }
  });
});

var ccopyStaticSample =
  program
    .command('copy-static-sample')
    .description('Copy static sample files into current dir.')
    .action(function() {
      var self = this;
      var restart = require('child_process').spawn('cp', ['-rv', __dirname + '/../example/static', './']);
      restart.stdout.on('data', function (data) {
        console.log(data.toString());
      });
      restart.stderr.on('data', function (data) {
        console.error(data.toString());
      });
      restart.on('close', function (code) {
        console.log('done with code: ' + code);
      });
    });

program.parse(process.argv);

// check miss hit of subcommand
// console.log(result);
var subCommandExist = (function(a, f) {
  for (var i=0; i<a.length; i++) {
    if (f(a[i])) {
      return i;
    }
  }
})(program.commands, function(elem) { return elem._name === result.args[0]; });

if(!subCommandExist || !program.args.length) {
  program.help();
}

